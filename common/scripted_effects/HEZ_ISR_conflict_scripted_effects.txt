#Mechanic Begins. 
HEZ_begin_conflict_with_israel = { 
	ISR = { 
		set_variable = { var = ISR_HEZ_WAR_SUPPORT val = 0.3 }
		set_variable = { var = ISR_HEZ_WAR_IMPACT val = -0.05 }
		add_dynamic_modifier = { modifier = ISR_HEZ_Conflict }

		set_variable = { var = AA_HEALTH_VAR value = 100 }}#higher-iron dome
	
	HEZ = { 
		set_variable = { var = ISR_HEZ_WAR_SUPPORT val = 0.3 }
		set_variable = { var = ISR_HEZ_WAR_IMPACT val = -0.05 }
		add_dynamic_modifier = { modifier = ISR_HEZ_Conflict }
		
		set_variable = { var = AA_HEALTH_VAR value = 50 }}
}
#Strikes
# set these in decisions when clicked. 
# GEN_launch_small_strike = {
# 		set_variable = { var = LAST_LAUNCH val = 1}
# 		set_variable = { var = MISSLES val = 20}
# 	}

# GEN_launch_medium_strike = {
# 	ROOT.owner = {
# 		set_variable = { var = LAST_LAUNCH val = 2}
# 		set_variable = { var = MISSLES val = 50}
# 	}
# }
# GEN_launch_large_strike = {
# 	ROOT.owner = {
# 		set_variable = { var = LAST_LAUNCH val = 3}
# 		set_variable = { var = MISSLES val = 100}
# 	}
# }
# GEN_target_aa_sites = {
# 	set_variable = { var = LAST_LAUNCH val = 4}
# 	set_variable = { var = MISSLES val = 10}
# }

GEN_strike = {
	GEN_calculate_effectiveness = yes
	GEN_destroy_buildings = yes
	ROOT.owner = { 	if = { 	limit = { original_tag = ISR }
							ISR_Strike_ideas = yes
						}
					else = {
							HEZ_Strike_ideas = yes
					}
					GEN_cleanup_strike = yes
	}
}

GEN_cleanup_strike = {
	clear_variable = MISSLES
	clear_variable = EFFECTIVENESS_VAR
	clear_variable = DESTROYED_INFRA
	clear_variable = DESTROYED_MILS
	clear_variable = DESTROYED_CIVS
}

ISR_Strike_ideas = {
	remove_ideas = { ISR_recently_struck }
	add_timed_idea = {
		idea = ISR_recently_conducted_strikes
		days = 7
	}
	HEZ = {
		add_timed_idea = {
			idea = HEZ_recently_struck
			days = 14
		}
	}
}
HEZ_Strike_ideas = {
	remove_ideas = { HEZ_recently_struck }
	add_timed_idea = {
		idea = HEZ_recently_conducted_strikes
		days = 7
	}
	ISR = {
		add_timed_idea = {
			idea = ISR_recently_struck
			days = 14
		}

	}
}
#math #calcs effectiness based on an AA_health Variable
GEN_calculate_effectiveness = {

	set_variable = { var = EFFECTIVENESS_VAR val = 100 }
	
	if = { 	limit = { ROOT.owner = { original_tag = ISR }} 
			
			subtract_from_variable = { 	var = EFFECTIVENESS_VAR 
										value = HEZ.AA_HEALTH_VAR }

		} 
	else = {
			subtract_from_variable = { 	var = EFFECTIVENESS_VAR 
										value = ISR.AA_HEALTH_VAR }
	}
	clamp_variable = {	var = EFFECTIVENESS_VAR
						min = 0
						max = 10 }

	random_list = {
		30 = { 
			multiply_variable = {
				var = EFFECTIVENESS_VAR
				val = 0.2
			}
		}
		40 = { 
			multiply_variable = {
				var = EFFECTIVENESS_VAR
				val = 0.1
			}
		} 
		30 = {} #no change			
	}
}

GEN_destroy_buildings = {
	set_variable = { var = DESTROYED_INFRA value = 0 }
	multiply_variable = { var = DESTROYED_INFRA value = 0.4 }
	set_variable = { var = DESTROYED_CIVS value = 0 }
	multiply_variable = { var = DESTROYED_CIVS value = 0.3 }
	set_variable = { var = DESTROYED_MILS value = 0 }
	multiply_variable = { var = DESTROYED_MILS value = 0.3 }

	ROOT = { 
		damage_building = {
			type = infrastructure
			damage = DESTROYED_INFRA
		}
		damage_building = {
			type = industrial_complex
			damage = DESTROYED_CIVS
		}
		damage_building = {
			type = arms_factory
			damage = DESTROYED_MILS
		}
	}

	GEN_calculate_esclation = yes
}


GEN_calculate_esclation = { #TODO TEST
	#RNG
	random_list = {
		30 = { 
			#event 
			multiply_variable = { var = EFFECTIVENESS_VAR value = 1.35 }
		}
		40 = { 
			#event
			multiply_variable = { var = EFFECTIVENESS_VAR value = 1.25 }
		}
		40 = { 
			multiply_variable = { var = EFFECTIVENESS_VAR  value = 0.9 }
		}
	}
	#deterministic
	#if recently conducted strikes, which were not retaliated on.
	if = { limit = { ROOT.owner = { original_tag = ISR }}
		if = { limit = { HEZ = { has_idea = HEZ_recently_struck }}
				multiply_variable = { var = EFFECTIVENESS_VAR value = 1.3 }
			}
	}
	else = {
		if = { limit = { ISR = { has_idea = ISR_recently_struck }}
				multiply_variable = { var = EFFECTIVENESS_VAR value = 1.3 }
			}
	}

	#if bombing campaign difference is larger than 1 (scale 1-3)
	if = { limit = { ROOT.owner = { original_tag = ISR }}
			set_variable = { var = AGGRESSIONDIFF value = HEZ.LAST_LAUNCH } #idk if this will work
			subtract_from_variable = { var = AGGRESSIONDIFF value = ISR.LAST_LAUNCH } 
		}
	else = { 
		set_variable = { var = AGGRESSIONDIFF value = ISR.LAST_LAUNCH }#idk if this will work
		subtract_from_variable = { var = AGGRESSIONDIFF value = HEZ.LAST_LAUNCH } 
	}
		
	if = { 	limit = { check_variable = { var = AGGRESSIONDIFF
											value = 1
											compare = greater_than_or_equals }}
				multiply_variable = { var = EFFECTIVENESS_VAR value = 1.5 }					
			}
	clear_variable = AGGRESSIONDIFF
}